---
import { type CollectionEntry } from "astro:content";
import Layout from "./Layout.astro";
import MainContainer from "../components/MainContainer.astro";

interface Props {
  product: CollectionEntry<"products">;
}
const { product } = Astro.props;

const { tecInfo, reviews } = product.data;
---

<script>
  // script das abas
  document.addEventListener("DOMContentLoaded", () => {
    const tabs = document.querySelectorAll(".tab");
    const contents = document.querySelectorAll(".tab-content");

    tabs.forEach((tab, index) => {
      tab.addEventListener("click", () => {
        // Remove o estado ativo de todas as abas
        tabs.forEach((t) =>
          t.classList.remove("border-primary", "text-primary")
        );
        tabs.forEach((t) =>
          t.classList.add("border-transparent", "text-gray-500")
        );

        // Adiciona o estado ativo à aba clicada
        tab.classList.add("border-primary", "text-primary");
        tab.classList.remove("border-transparent", "text-gray-500");

        // Oculta todo o conteúdo e exibe o correspondente à aba clicada
        contents.forEach((content) => content.classList.add("hidden"));
        contents[index].classList.remove("hidden");
      });
    });
  });

  // galeria teste
  document.addEventListener("DOMContentLoaded", () => {
    let currentIndex = 0;
    const carousel = document.getElementById("video-carousel") as HTMLElement;
    const availableVideos = JSON.parse(
      carousel?.getAttribute("data-available-videos") as string
    ) as HTMLAnchorElement[];

    const videosLength = availableVideos.length;

    // Função para atualizar o carrossel com animação suave
    function updateCarousel() {
      carousel.style.transition = "transform 0.5s ease-out";
      const percentage = -currentIndex * 80; // Controla a translação
      carousel.style.transform = `translateX(${percentage}%)`;
    }

    // Função para redefinir a transição ao chegar nos vídeos duplicados
    function handleLoop() {
      if (currentIndex === -1) {
        currentIndex = videosLength; // Vai para o último vídeo real
        carousel.style.transition = "transform 0.5s ease-out"; // Remove a transição para um salto imediato
        carousel.style.transform = `translateX(-${currentIndex * 80}%)`;
      }
      if (currentIndex === videosLength + 1) {
        currentIndex = 1; // Vai para o primeiro vídeo real
        carousel.style.transition = "transform 0.5s ease-out"; // Remove a transição para um salto imediato
        carousel.style.transform = `translateX(-${currentIndex * 80}%)`;
      }
    }

    // Evento para botão "anterior"
    document.getElementById("prev-btn")?.addEventListener("click", () => {
      currentIndex =
        currentIndex === 0 ? availableVideos.length - 1 : currentIndex - 1;
      updateCarousel();
      setTimeout(handleLoop, 500); // Verifica o loop após a transição
    });

    // Evento para botão "próximo"
    document.getElementById("next-btn")?.addEventListener("click", () => {
      currentIndex =
        currentIndex === availableVideos.length - 1 ? 0 : currentIndex + 1;
      updateCarousel();
      setTimeout(handleLoop, 500); // Verifica o loop após a transição
    });
  });
</script>

<Layout title='Frusrite""'>
  <MainContainer>
    <!-- TODO: corrigir estilo para funcionar com o tema escuro -->
    <!-- component -->
    <div class="bg-white font-sans">
      <div class="mx-auto max-w-4xl p-4 lg:max-w-7xl">
        <div
          class="grid grid-cols-1 items-start gap-12 rounded-lg p-6 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.3)] lg:grid-cols-5"
        >
          <div class="top-0 w-full text-center lg:sticky lg:col-span-3">
            <!-- imagem principal -->
            <div
              class="relative rounded-lg px-4 py-10 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.3)]"
            >
              <img
                src={product.data.mainImage}
                alt="product-main-image"
                class="mx-auto w-3/4 rounded object-cover"
              />
            </div>

            <!-- galeria de imagens -->
            <div class="mx-auto mt-6 flex flex-wrap justify-center gap-6">
              <!-- TODO: criar logica para trocar imagens ao clicar e indicador de qual imagem esta selecionada -->
              <!-- loop para cada image -->
              {
                product.data.gallery.map((image) => (
                  <div class="flex h-20 w-24 cursor-pointer items-center justify-center rounded-lg p-4 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.3)]">
                    <img src={image} alt="Product2" class="w-full" />
                  </div>
                ))
              }
            </div>
          </div>
          <!-- descrição -->
          <div class="lg:col-span-2">
            <h2 class="text-2xl font-extrabold text-gray-800">
              {product.data.title}
            </h2>

            <div class="mt-4 flex flex-wrap gap-4">
              <!-- aqui vai vir a descrição principal -->
              {
                product.data.description.map((line) => (
                  <p class="my-2 text-gray-600 dark:text-gray-300">{line}</p>
                ))
              }
            </div>
          </div>
        </div>
        <div class="mt-16 p-6 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.3)]">
          <!-- tabs -->
          <div class="mb-4 flex justify-center space-x-4">
            <button
              data-tab="0"
              class="tab border-b-2 border-primary px-4 py-2 text-primary hover:text-primary dark:hover:text-white"
              >{product.data.extra.title}</button
            >
            <button
              data-tab="1"
              class="tab border-b-2 border-transparent px-4 py-2 text-gray-500 hover:text-primary dark:hover:text-white"
              >Como comprar</button
            >
            <button
              data-tab="2"
              class="tab border-b-2 border-transparent px-4 py-2 text-gray-500 hover:text-primary dark:hover:text-white"
              >Especificações Técnicas</button
            >
          </div>

          <!-- Conteúdo das abas -->
          <div class="p-4">
            <div class="tab-content rounded-lg p-4" data-content="0">
              <p class="my-4 text-gray-600 dark:text-gray-300">
                {product.data.extra.content}
              </p>
            </div>
            <div class="tab-content hidden rounded-lg p-4" data-content="1">
              <p class="my-4 text-gray-600 dark:text-gray-300">
                O {product.data.title} está disponível para compra pela lista de
                espera. Abrimos lotes para pré-venda de tempos em tempos e avisamos
                aos primeiros colocados da lista de espera, com isso, fazemos a venda
                e estipulamos um prazo de envio. Para participar da lista de espera,
                por favor, mande uma mensagem no WhatsApp:
                <a
                  href="https://api.whatsapp.com/send/?phone=5541991912258&text&type=phone_number&app_absent=0"
                  target="_blank"
                  class="flex items-center space-x-3 transition hover:text-primary"
                >
                  (41) 99191-2258.
                </a>
              </p>
              <ul class="text-gray-600 dark:text-gray-300">
                <span>Valor:</span>
                {
                  product.data.paymentsMethods.map((item) => (
                    <li>
                      {item.name}: R${item.price} + frete {item.disclaimer}
                      {/* TODO: criar um tooltip para exibir o disclaimer */}
                    </li>
                  ))
                }
              </ul>
            </div>
            <div class="tab-content hidden rounded-lg p-4" data-content="2">
              <div class="flex flex-wrap">
                <div class="flex-1">
                  <ul class="text-gray-600 dark:text-gray-300">
                    <li>
                      Alimentação: {tecInfo.font}
                    </li>
                    <li>
                      Consumo: {tecInfo.consumption}
                    </li>
                    <li>
                      Controles: {tecInfo.knobs}
                    </li>
                    <li class=`${tecInfo.switches ? '' : 'hidden'}`>
                      Chaves: {tecInfo.switches}
                    </li>
                    <li>
                      Indicador: {tecInfo.indicators}
                    </li>
                    <li>
                      Conexões: {tecInfo.conections}
                    </li>
                  </ul>
                  <ul class="mt-4 text-gray-600 dark:text-gray-300">
                    <span>Dimensões</span>
                    <div class="m-2">
                      <li>
                        Comprimento: {tecInfo.length}
                      </li>
                      <li>
                        Largura: {tecInfo.width}
                      </li>
                      <li>
                        Altura Máxima: {tecInfo.maxHeight}
                      </li>
                      <li>
                        Altura Mínima: {tecInfo.minHeight}
                      </li>
                      <li>
                        Peso: {tecInfo.weight}
                      </li>
                    </div>
                  </ul>
                </div>
                <div class="flex flex-1 items-center justify-center">
                  <img
                    src={tecInfo.image}
                    alt="Descrição da Imagem"
                    class="h-auto max-w-full rounded-lg shadow-lg"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          class="mt-16 h-[50%] p-6 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.3)]"
        >
          <h3 class="text-xl font-bold text-gray-800">Reviews</h3>
          <!-- galeria de video -->
          <div class="mt-4 space-y-6 text-gray-800">
            <!-- inicio galeria com carrossel -->
            <div
              class="gallery-container relative mx-auto w-full max-w-4xl overflow-hidden"
            >
              <!-- Contêiner do carrossel com 3 vídeos -->
              <div
                id="video-carousel"
                class="flex items-center transition-transform duration-500 ease-out"
                style="transform: translateX(0%);"
                data-available-videos={JSON.stringify(reviews)}
              >
                {
                  reviews.map((video, index) => (
                    <div class="video-wrapper h-500 relative mx-2 w-[80%] flex-shrink-0">
                      <iframe
                        id="gallery-video"
                        class="h-96 w-full rounded-lg object-contain shadow-lg"
                        src={video}
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen
                      />
                    </div>
                  ))
                }
              </div>
              <!-- Botões de navegação -->
              <button
                id="prev-btn"
                class="absolute left-2 top-1/2 -translate-y-1/2 transform rounded-full bg-gray-500 bg-opacity-50 px-4 py-2 text-primary transition hover:scale-110 hover:bg-opacity-75"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 19l-7-7 7-7"></path>
                </svg>
              </button>
              <button
                id="next-btn"
                class="absolute right-2 top-1/2 -translate-y-1/2 transform rounded-full bg-gray-500 bg-opacity-50 px-4 py-2 text-primary transition hover:scale-110 hover:bg-opacity-75"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </MainContainer>
</Layout>
