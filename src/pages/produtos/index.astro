---
import { getCollection, type InferEntrySchema } from "astro:content";
import Container from "../../components/Container.astro";
import MainContainer from "../../components/MainContainer.astro";
import Layout from "../../layouts/Layout.astro";

export type Product = {
  id: string;
  collection: string;
  data: InferEntrySchema<"products">;
};

// @ts-ignore
export async function getStaticPaths(): Promise<any> {
    const productCollection = await getCollection('products');

  return productCollection.map((product: any) => ({
    params: { slug: product.id },
    props: { entry : product }
  }))
}

const productCollection = await getCollection('products');
const products = productCollection.sort((a , b) => a.data.id - b.data.id);
---

<Layout title="Frusrite">
    <MainContainer>
        <div id="produtos" class="flex flex-col items-center">
            <Container>
                <div class="mb-12 space-y-2 text-center">
                    <h2 class="text-3xl font-bold text-gray-800 md:text-4xl dark:text-white">
                        Conhe√ßa nossos pedais!
                    </h2>
                </div>
                <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
                    {
                        products.map((product: Product) => (
                            <div class="group p-6 sm:p-8 rounded-3xl bg-white border border-gray-100 dark:shadow-none dark:border-gray-700 dark:bg-gray-800 bg-opacity-50 shadow-2xl shadow-gray-600/10">
                                <div class="relative overflow-hidden rounded-xl">
                                    <img  src={product.data.image}
                                    alt="art cover" loading="lazy" width="1000" height="667" class="h-64 w-full object-cover object-top transition duration-500 group-hover:scale-105"/>
                                </div>
                                <div class="mt-6 relative">
                                    <h3 class="text-2xl font-semibold text-gray-800 dark:text-white">
                                        {product.data.title}
                                    </h3>
                                    <p class="mt-6 mb-8 text-gray-600 dark:text-gray-300">
                                        {product.data.summary}
                                    </p>
                                    <a class="inline-block" href=`produtos/${product.id}`>
                                        <span class="text-info dark:text-blue-300">Saiba mais</span>
                                    </a>
                                </div>
                            </div>                         
                        ))
                    }
                </div>
            </Container>
        </div>
    </MainContainer>
</Layout>